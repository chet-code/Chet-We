<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Maharashtra Weather App</title>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f8faf8;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      color: #2d3748;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    h1, h2, h3 {
      color: #2f855a;
    }
    select {
      width: 100%;
      padding: 12px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      font-size: 16px;
      margin: 10px 0;
      background: white;
      color: #4a5568;
    }
    .weather-header {
      text-align: center;
      margin-bottom: 20px;
    }
    .current-weather {
      background: #f0fff4;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 25px;
    }
    .temp-display {
      font-size: 3.5rem;
      font-weight: 300;
      color: #2f855a;
      margin: 10px 0;
    }
    .weather-desc {
      font-size: 1.2rem;
      color: #4a5568;
      margin-bottom: 15px;
    }
    .detail-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-top: 20px;
    }
    .detail-card {
      background: white;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .forecast-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 12px;
      margin-top: 25px;
    }
    .forecast-day {
      background: white;
      padding: 12px;
      border-radius: 8px;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .hourly-forecast {
      display: flex;
      overflow-x: auto;
      gap: 10px;
      padding: 15px 0;
      margin-top: 20px;
    }
    .hour-card {
      min-width: 70px;
      background: white;
      padding: 12px;
      border-radius: 8px;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    .hour-time {
      font-weight: 600;
      color: #2f855a;
      margin-bottom: 5px;
    }
    .hour-temp {
      font-size: 1.1rem;
      color: #4a5568;
    }
    .day-name {
      font-weight: 600;
      color: #2f855a;
      margin-bottom: 8px;
    }
    .forecast-temp {
      font-size: 1.1rem;
      color: #4a5568;
    }
    .last-updated {
      text-align: center;
      margin-top: 25px;
      color: #718096;
      font-size: 0.9rem;
    }
    .loading {
      text-align: center;
      padding: 40px;
      color: #718096;
    }
    .location-selectors {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 20px;
    }
    .tab-container {
      display: flex;
      margin-top: 20px;
      border-bottom: 1px solid #e2e8f0;
    }
    .tab {
      padding: 10px 20px;
      cursor: pointer;
      border-bottom: 2px solid transparent;
    }
    .tab.active {
      border-bottom: 2px solid #2f855a;
      color: #2f855a;
      font-weight: 600;
    }
    @media (max-width: 600px) {
      .location-selectors {
        grid-template-columns: 1fr;
      }
      .detail-grid {
        grid-template-columns: 1fr 1fr;
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Helper functions defined at top level
    const getWeatherDescription = (code) => {
      const weatherMap = {
        0: "Clear sky", 1: "Mainly clear", 2: "Partly cloudy", 3: "Overcast",
        45: "Fog", 48: "Fog", 51: "Light drizzle", 53: "Moderate drizzle",
        55: "Dense drizzle", 56: "Freezing drizzle", 57: "Freezing drizzle",
        61: "Light rain", 63: "Moderate rain", 65: "Heavy rain",
        80: "Light showers", 81: "Moderate showers", 82: "Violent showers",
        95: "Thunderstorm", 96: "Thunderstorm", 99: "Thunderstorm"
      };
      return weatherMap[code] || "";
    };

    const getWeatherIcon = (code) => {
      const icons = {
        0: "☀️", 1: "🌤️", 2: "⛅", 3: "☁️",
        45: "🌫️", 48: "🌫️", 51: "🌦️", 53: "🌧️",
        55: "🌧️", 56: "🌧️❄️", 57: "🌧️❄️", 61: "🌧️",
        63: "🌧️", 65: "🌧️", 66: "🌧️❄️", 67: "🌧️❄️",
        80: "🌦️", 81: "🌧️", 82: "🌧️", 95: "⛈️",
        96: "⛈️", 99: "⛈️"
      };
      return icons[code] || "🌈";
    };

    const getDayName = (dateStr) => {
      const date = new Date(dateStr);
      return date.toLocaleDateString('en-US', { weekday: 'short' });
    };

    const formatTime = (timeStr) => {
      const date = new Date(timeStr);
      return date.toLocaleTimeString('en-US', { hour: 'numeric', hour12: true });
    };

    function WeatherApp() {
      // STATE DEFINITIONS
      const [weather, setWeather] = useState(null);
      const [forecast, setForecast] = useState(null);
      const [hourlyData, setHourlyData] = useState(null);
      const [loading, setLoading] = useState(true);
      const [selectedDistrict, setSelectedDistrict] = useState("Buldhana");
      const [selectedTown, setSelectedTown] = useState("Buldhana");
      const [lastUpdated, setLastUpdated] = useState("");
      const [activeTab, setActiveTab] = useState("daily");
      const [error, setError] = useState(null);

      // Comprehensive list of Maharashtra districts and towns
      const maharashtraTowns = {
        // Vidarbha Region
        "Buldhana": ["Buldhana", "Chikhli", "Malkapur", "Mehkar", "Khamgaon", "Shegaon", "Lonar"],
        "Amravati": ["Amravati", "Achalpur", "Daryapur", "Anjangaon", "Chandurbazar"],
        "Akola": ["Akola", "Akot", "Patur", "Balapur", "Telhara"],
        "Washim": ["Washim", "Mangrulpir", "Karanja", "Risod"],
        "Yavatmal": ["Yavatmal", "Pusad", "Umarkhed", "Digras", "Ghatanji"],
        "Nagpur": ["Nagpur", "Katol", "Ramtek", "Umred", "Kalmeshwar"],
        "Wardha": ["Wardha", "Arvi", "Hinganghat", "Pulgaon"],
        "Chandrapur": ["Chandrapur", "Ballarpur", "Warora", "Bramhapuri"],
        "Gadchiroli": ["Gadchiroli", "Aheri", "Sironcha", "Chamorshi"],
        "Bhandara": ["Bhandara", "Tumsar", "Pauni", "Sakoli"],
        "Gondia": ["Gondia", "Tirora", "Deori", "Amgaon"],
        
        // Marathwada Region
        "Aurangabad": ["Aurangabad", "Khultabad", "Gangapur", "Sillod"],
        "Jalna": ["Jalna", "Ambad", "Bhokardan", "Partur"],
        "Parbhani": ["Parbhani", "Gangakhed", "Pathri", "Jintur"],
        "Hingoli": ["Hingoli", "Kalamnuri", "Basmath", "Sengaon"],
        "Nanded": ["Nanded", "Deglur", "Mukhed", "Kandhar"],
        "Latur": ["Latur", "Ahmadpur", "Udgir", "Nilanga"],
        "Osmanabad": ["Osmanabad", "Tuljapur", "Umarga", "Paranda"],
        "Beed": ["Beed", "Georai", "Majalgaon", "Ashti", "Ambejogai"],
        
        // Khandesh Region
        "Jalgaon": ["Jalgaon", "Bhusawal", "Chalisgaon", "Pachora", "Erandol"],
        "Dhule": ["Dhule", "Shirpur", "Sakri", "Nardana"],
        "Nandurbar": ["Nandurbar", "Shahada", "Taloda", "Navapur"],
        
        // Western Maharashtra
        "Pune": ["Pune", "Baramati", "Bhor", "Daund", "Indapur", "Junnar"],
        "Nashik": ["Nashik", "Malegaon", "Sinnar", "Igatpuri", "Niphad"],
        "Ahmednagar": ["Ahmednagar", "Shrirampur", "Kopargaon", "Sangamner", "Shirdi"],
        "Satara": ["Satara", "Wai", "Karad", "Patan", "Phaltan"],
        "Sangli": ["Sangli", "Miraj", "Tasgaon", "Kavathemahankal"],
        "Kolhapur": ["Kolhapur", "Ichalkaranji", "Shirol", "Gaganbawda"],
        "Solapur": ["Solapur", "Barshi", "Pandharpur", "Malshiras", "Mohol"],
        "Ratnagiri": ["Ratnagiri", "Chiplun", "Khed", "Dapoli", "Guhagar"],
        "Sindhudurg": ["Sindhudurg", "Kankavli", "Malvan", "Vengurla", "Sawantwadi"],
        "Raigad": ["Raigad", "Alibag", "Pen", "Mahad", "Mangaon"],
        "Thane": ["Thane", "Kalyan", "Bhiwandi", "Murbad", "Shahapur"],
        "Palghar": ["Palghar", "Vasai", "Dahanu", "Talasari", "Vikramgad"],
        
        // Special towns
        "Mumbai": ["Mumbai", "Navi Mumbai"],
        "Mumbai Suburban": ["Andheri", "Bandra", "Borivali", "Dahisar", "Kandivali"]
      };

      // Coordinates for towns (simplified - in real app would need complete dataset)
      const getTownCoordinates = (district, town) => {
        // Default coordinates for each district
        const districtCoordinates = {
          "Buldhana": { lat: 20.53, lon: 76.18 },
          "Amravati": { lat: 20.93, lon: 77.78 },
          "Akola": { lat: 20.70, lon: 77.00 },
          "Washim": { lat: 20.11, lon: 77.13 },
          "Yavatmal": { lat: 20.40, lon: 78.13 },
          "Nagpur": { lat: 21.15, lon: 79.09 },
          "Wardha": { lat: 20.75, lon: 78.60 },
          "Chandrapur": { lat: 19.97, lon: 79.30 },
          "Gadchiroli": { lat: 19.93, lon: 80.00 },
          "Bhandara": { lat: 21.17, lon: 79.65 },
          "Gondia": { lat: 21.45, lon: 80.20 },
          "Aurangabad": { lat: 19.88, lon: 75.32 },
          "Jalna": { lat: 19.83, lon: 75.88 },
          "Parbhani": { lat: 19.27, lon: 76.78 },
          "Hingoli": { lat: 19.72, lon: 77.15 },
          "Nanded": { lat: 19.15, lon: 77.33 },
          "Latur": { lat: 18.40, lon: 76.58 },
          "Osmanabad": { lat: 18.18, lon: 76.05 },
          "Beed": { lat: 18.99, lon: 75.76 },
          "Jalgaon": { lat: 21.01, lon: 75.56 },
          "Dhule": { lat: 20.90, lon: 74.78 },
          "Nandurbar": { lat: 21.37, lon: 74.24 },
          "Pune": { lat: 18.52, lon: 73.86 },
          "Nashik": { lat: 20.01, lon: 73.79 },
          "Ahmednagar": { lat: 19.09, lon: 74.74 },
          "Satara": { lat: 17.68, lon: 74.00 },
          "Sangli": { lat: 16.87, lon: 74.57 },
          "Kolhapur": { lat: 16.70, lon: 74.24 },
          "Solapur": { lat: 17.66, lon: 75.91 },
          "Ratnagiri": { lat: 16.99, lon: 73.30 },
          "Sindhudurg": { lat: 16.12, lon: 73.68 },
          "Raigad": { lat: 18.82, lon: 73.22 },
          "Thane": { lat: 19.19, lon: 72.97 },
          "Palghar": { lat: 19.69, lon: 72.76 },
          "Mumbai": { lat: 19.08, lon: 72.88 },
          "Mumbai Suburban": { lat: 19.13, lon: 72.93 }
        };
        
        // Return district center if town coordinates not available
        return districtCoordinates[district] || { lat: 19.08, lon: 72.88 }; // Default to Mumbai
      };

      useEffect(() => {
        const fetchWeather = async () => {
          setLoading(true);
          setError(null);
          try {
            const { lat, lon } = getTownCoordinates(selectedDistrict, selectedTown);
            
            // Fetch current weather, daily forecast, and hourly data
            const response = await fetch(
              `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,weather_code,wind_speed_10m&daily=weather_code,temperature_2m_max,temperature_2m_min&hourly=temperature_2m,weather_code&timezone=auto`
            );
            
            if (!response.ok) {
              throw new Error('Failed to fetch weather data');
            }
            
            const data = await response.json();
            
            // Process current weather
            setWeather({
              temp: data.current.temperature_2m,
              humidity: data.current.relative_humidity_2m,
              wind: data.current.wind_speed_10m,
              weather_code: data.current.weather_code,
              icon: getWeatherIcon(data.current.weather_code)
            });
            
            // Process 7-day forecast
            const dailyForecast = data.daily.time.map((day, index) => ({
              date: day,
              day: getDayName(day),
              max_temp: data.daily.temperature_2m_max[index],
              min_temp: data.daily.temperature_2m_min[index],
              weather_code: data.daily.weather_code[index],
              icon: getWeatherIcon(data.daily.weather_code[index])
            }));
            setForecast(dailyForecast.slice(0, 7));
            
            // Process hourly data (next 24 hours)
            const now = new Date();
            const hourlyForecast = data.hourly.time
              .map((time, index) => ({
                time,
                hour: formatTime(time),
                temp: data.hourly.temperature_2m[index],
                weather_code: data.hourly.weather_code[index],
                icon: getWeatherIcon(data.hourly.weather_code[index])
              }))
              .filter(hour => new Date(hour.time) > now)
              .slice(0, 24);
            setHourlyData(hourlyForecast);
            
            setLastUpdated(new Date().toLocaleTimeString());
          } catch (error) {
            console.error("Error fetching weather:", error);
            setError(error.message || "Failed to load weather data");
          } finally {
            setLoading(false);
          }
        };

        fetchWeather();
        const interval = setInterval(fetchWeather, 600000); // Update every 10 mins
        return () => clearInterval(interval);
      }, [selectedDistrict, selectedTown]);

      if (loading) {
        return (
          <div className="container">
            <div className="loading">
              <h2>Loading weather data for {selectedTown}...</h2>
              <p>Please wait while we fetch the latest information</p>
            </div>
          </div>
        );
      }

      if (error) {
        return (
          <div className="container">
            <div className="loading">
              <h2>Error Loading Data</h2>
              <p>{error}</p>
              <p>Please try again later or select a different location</p>
            </div>
          </div>
        );
      }

      return (
        <div className="container">
          <div className="weather-header">
            <h1>Maharashtra Weather</h1>
            <p>Comprehensive weather coverage for all districts and towns</p>
          </div>
          
          <div className="location-selectors">
            <div>
              <label htmlFor="district-select">District</label>
              <select 
                id="district-select"
                value={selectedDistrict} 
                onChange={(e) => {
                  setSelectedDistrict(e.target.value);
                  setSelectedTown(maharashtraTowns[e.target.value][0]);
                }}
              >
                {Object.keys(maharashtraTowns).map(district => (
                  <option key={district} value={district}>{district}</option>
                ))}
              </select>
            </div>
            
            <div>
              <label htmlFor="town-select">Town/City</label>
              <select 
                id="town-select"
                value={selectedTown} 
                onChange={(e) => setSelectedTown(e.target.value)}
              >
                {maharashtraTowns[selectedDistrict].map(town => (
                  <option key={town} value={town}>{town}</option>
                ))}
              </select>
            </div>
          </div>

          {weather && (
            <div className="current-weather">
              <h2>{selectedTown}, {selectedDistrict}</h2>
              <div style={{display: 'flex', alignItems: 'center', justifyContent: 'center'}}>
                <span style={{fontSize: '3rem', marginRight: '15px'}}>{weather.icon}</span>
                <div>
                  <div className="temp-display">{Math.round(weather.temp)}°C</div>
                  <div className="weather-desc">
                    {weather.icon} {getWeatherDescription(weather.weather_code)}
                  </div>
                </div>
              </div>
              
              <div className="detail-grid">
                <div className="detail-card">
                  <div style={{fontSize: '1.4rem'}}>💧</div>
                  <div>Humidity</div>
                  <div className="detail-value">{weather.humidity}%</div>
                </div>
                <div className="detail-card">
                  <div style={{fontSize: '1.4rem'}}>💨</div>
                  <div>Wind Speed</div>
                  <div className="detail-value">{Math.round(weather.wind)} km/h</div>
                </div>
                <div className="detail-card">
                  <div style={{fontSize: '1.4rem'}}>📍</div>
                  <div>Location</div>
                  <div className="detail-value">{selectedTown}</div>
                </div>
              </div>
            </div>
          )}

          <div className="tab-container">
            <div 
              className={`tab ${activeTab === 'daily' ? 'active' : ''}`}
              onClick={() => setActiveTab('daily')}
            >
              7-Day Forecast
            </div>
            <div 
              className={`tab ${activeTab === 'hourly' ? 'active' : ''}`}
              onClick={() => setActiveTab('hourly')}
            >
              Hourly Forecast
            </div>
          </div>

          {activeTab === 'daily' && forecast && (
            <div className="forecast-container">
              {forecast.map((day, index) => (
                <div className="forecast-day" key={day.date}>
                  <div className="day-name">{index === 0 ? 'Today' : day.day}</div>
                  <div style={{fontSize: '1.5rem', margin: '5px 0'}}>{day.icon}</div>
                  <div className="forecast-temp">
                    <span style={{fontWeight: '600'}}>{Math.round(day.max_temp)}°</span> / {Math.round(day.min_temp)}°
                  </div>
                </div>
              ))}
            </div>
          )}

          {activeTab === 'hourly' && hourlyData && (
            <div>
              <h3>Next 24 Hours</h3>
              <div className="hourly-forecast">
                {hourlyData.map((hour, index) => (
                  <div className="hour-card" key={index}>
                    <div className="hour-time">{hour.hour}</div>
                    <div style={{fontSize: '1.5rem', margin: '5px 0'}}>{hour.icon}</div>
                    <div className="hour-temp">{Math.round(hour.temp)}°</div>
                  </div>
                ))}
              </div>
            </div>
          )}
          
          <div className="last-updated">
            Last updated: {lastUpdated} | Data updates every 10 minutes
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<WeatherApp />);
  </script>
</body>
</html>
